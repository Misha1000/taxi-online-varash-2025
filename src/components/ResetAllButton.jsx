// src/components/ResetAllButton.jsx

// 1) –Ü–º–ø–æ—Ä—Ç—É—î–º–æ React —ñ —Ö—É–∫ useState ‚Äî —â–æ–± –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—É (–π–¥–µ —á–∏ –Ω—ñ)
import React, { useState } from 'react';

// 2) –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –Ω–∞—à—É –±–∞–∑—É –¥–∞–Ω–∏—Ö (Firestore)
import { db } from '../firebase';

// 3) –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ Firestore –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
import { collection, getDocs, deleteDoc, doc } from 'firebase/firestore';

// 4) –°—Ç–≤–æ—Ä—é—î–º–æ –∑–º—ñ–Ω–Ω—É –∑ –ø–µ—Ä–µ–ª—ñ–∫–æ–º –∫–æ–ª–µ–∫—Ü—ñ–π, —è–∫—ñ –±—É–¥–µ–º–æ —á–∏—Å—Ç–∏—Ç–∏
//    –ú–æ–∂–µ—à –¥–æ–¥–∞–≤–∞—Ç–∏ —Ç—É—Ç —ñ–Ω—à—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó, —è–∫—â–æ —ó—Ö —Å—Ç–≤–æ—Ä–∏—à (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 'passengers')
const COLLECTIONS_TO_WIPE = ['drivers', 'orders'];

// 5) –¶–µ –ø—Ä–æ—Å—Ç–∏–π –ø–∞—Ä–æ–ª—å, —â–æ–± –≤–∏–ø–∞–¥–∫–æ–≤–æ –Ω—ñ—Ö—Ç–æ –Ω–µ –Ω–∞—Ç–∏—Å–Ω—É–≤ —ñ –Ω–µ –≤–∏–¥–∞–ª–∏–≤ —É—Å–µ
//    –ü–û–ú–Ü–ù–Ø–ô –ô–û–ì–û –ù–ê –°–í–Ü–ô
const ADMIN_PASSWORD = '123456';

// 6) –û–≥–æ–ª–æ—à—É—î–º–æ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏
function ResetAllButton() {
  // 7) –°—Ç–∞—Ç—É—Å ‚Äî —á–∏ –º–∏ –∑–∞—Ä–∞–∑ –≤–∏–¥–∞–ª—è—î–º–æ (—â–æ–± –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É)
  const [isWiping, setIsWiping] = useState(false);

  // 8) –¢–µ–∫—Å—Ç–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å (—â–æ –∑–∞—Ä–∞–∑ —Ä–æ–±–∏—Ç—å—Å—è)
  const [status, setStatus] = useState('');

  // 9) –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
  const handleWipeAll = async () => {
    // 10) –ü–∏—Ç–∞—î–º–æ –ø–∞—Ä–æ–ª—å —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø—Ä–æ—Å—Ç–∏–π prompt)
    const pwd = prompt('–í–≤–µ–¥—ñ—Ç—å –∞–¥–º—ñ–Ω-–ø–∞—Ä–æ–ª—å, —â–æ–± –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ:');

    // 11) –Ø–∫—â–æ –ø–∞—Ä–æ–ª—å –Ω–µ –∑–±—ñ–≥–∞—î—Ç—å—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–∏—Ö–æ–¥–∏–º–æ
    if (pwd !== ADMIN_PASSWORD) {
      alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å. –û–ø–µ—Ä–∞—Ü—ñ—è —Å–∫–∞—Å–æ–≤–∞–Ω–∞.');
      return;
    }

    // 12) –°—Ç–∞–≤–∏–º–æ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å ‚Äî –ø–æ—á–∞–ª–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    setIsWiping(true);
    setStatus('–ü–æ—á–∏–Ω–∞—é –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ Firestore...');

    try {
      // 13) –î–ª—è –∫–æ–∂–Ω–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó –∑ –Ω–∞—à–æ–≥–æ —Å–ø–∏—Å–∫—É ‚Äî –≤–∏–¥–∞–ª–∏–º–æ –≤—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏
      for (const colName of COLLECTIONS_TO_WIPE) {
        setStatus(`–í–∏–¥–∞–ª—è—é –∫–æ–ª–µ–∫—Ü—ñ—é: ${colName}...`);

        // 14) –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—é
        const colRef = collection(db, colName);

        // 15) –ß–∏—Ç–∞—î–º–æ –≤—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó
        const snapshot = await getDocs(colRef);

        // 16) –ü—Ä–æ—Ö–æ–¥–∏–º–æ—Å—è –ø–æ –∫–æ–∂–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É —ñ –≤–∏–¥–∞–ª—è—î–º–æ –π–æ–≥–æ
        for (const d of snapshot.docs) {
          // 17) –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç
          const docRef = doc(db, colName, d.id);

          // 18) –í–∏–¥–∞–ª—è—î–º–æ –¥–æ–∫—É–º–µ–Ω—Ç –∑ –ë–î
          await deleteDoc(docRef);
        }
      }

      // 19) –ü—ñ—Å–ª—è —á–∏—Å—Ç–∫–∏ Firestore ‚Äî —á–∏—Å—Ç–∏–º–æ localStorage (—Ç–µ–ª–µ—Ñ–æ–Ω–∏, —ñ—Å—Ç–æ—Ä—ñ—é –∞–¥—Ä–µ—Å —ñ —Ç.–¥.)
      setStatus('–û—á–∏—â–∞—é localStorage...');
      localStorage.removeItem('driverVerified');
      localStorage.removeItem('driverPhone');
      localStorage.removeItem('driverData');

      localStorage.removeItem('passengerVerified');
      localStorage.removeItem('passengerPhone');
      localStorage.removeItem('passengerName');
      localStorage.removeItem('passengerHistory');

      // 20) –í—Å–µ –≥–æ—Ç–æ–≤–æ ‚Äî –ø–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ
      setStatus('–ì–æ—Ç–æ–≤–æ! –í—Å–µ –≤–∏–¥–∞–ª–µ–Ω–æ.');
      alert('–£—Å—ñ –¥–∞–Ω—ñ –≤–∏–¥–∞–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!');
    } catch (err) {
      // 21) –Ø–∫—â–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫ ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–º–∏–ª–∫—É –≤ –∫–æ–Ω—Å–æ–ª—ñ —Ç–∞ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
      console.error(err);
      setStatus('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ. –î–∏–≤–∏—Å—å –∫–æ–Ω—Å–æ–ª—å.');
      alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä –∫–æ–Ω—Å–æ–ª—å.');
    } finally {
      // 22) –ó–Ω—ñ–º–∞—î–º–æ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å ‚Äî –∑–∞–≤–µ—Ä—à–∏–ª–∏
      setIsWiping(false);
    }
  };

  // 23) –†–µ–Ω–¥–µ—Ä–∏–º–æ –∫–Ω–æ–ø–∫—É —ñ —Å—Ç–∞—Ç—É—Å
  return (
    <div style={{ marginTop: 20 }}>
      {/* 24) –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –≤—Å—å–æ–≥–æ. –í–æ–Ω–∞ –±–ª–æ–∫—É—î—Ç—å—Å—è, –∫–æ–ª–∏ –π–¥–µ –ø—Ä–æ—Ü–µ—Å */}
      <button onClick={handleWipeAll} disabled={isWiping}>
        {isWiping ? '–í–∏–¥–∞–ª—è—é...' : 'üß® –°–ö–ò–ù–£–¢–ò –í–°–ï (–∞–¥–º—ñ–Ω)'}
      </button>

      {/* 25) –Ø–∫—â–æ —î —Å—Ç–∞—Ç—É—Å ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –π–æ–≥–æ */}
      {status && <p style={{ fontSize: 14, color: '#555' }}>{status}</p>}
    </div>
  );
}

// 26) –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
export default ResetAllButton;
